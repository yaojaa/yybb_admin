webpackJsonp([16],{"28BB":function(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var i=t("fZjL"),s=t.n(i),a=t("mvHQ"),r=t.n(a),l={name:"training",data:function(){return{breadcrumb:[{name:"营销管理",url:"/marketing/markList"},{name:"满减/立减优惠券",url:"/marketing/fullReducionCouponList"},{name:"添加"}],pickerOptions:{shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}},{text:"昨天",onClick:function(e){var o=new Date;o.setTime(o.getTime()-864e5),e.$emit("pick",o)}},{text:"一周前",onClick:function(e){var o=new Date;o.setTime(o.getTime()-6048e5),e.$emit("pick",o)}}]},ruleForm:{coupon_desc:"",coupon_code:"",coupon_title:"",rules:{is_full:0,price:"",reduce_price:""},limits:{limit_cycle:"1",limit_times:"",limit_total_times:""},coupon_range:{category_id:1,goods_id:0},coupon_expire_type:1,coupon_in_shop:1,coupon_range_type:1,date_expire_type:0,coupon_expire:{coupon_expire_day:"",coupon_expire_start_time:"",coupon_expire_end_time:""}},rules:{coupon_title:[{required:!0,message:"优惠券标题",trigger:"blur"}],coupon_range_type:[{required:!0,message:"请选择使用范围",trigger:"change"}]},industryForm:{},goodsList:[],formLabelWidth:"120px",industryVisible:!1,goodsVisible:!1,serviceVisible:!1,inventedVisible:!1,industry_id:"",goods_name:"",tabPosition:"left",activeId:"",radioGoodsId:"",radioServiceId:"",checkedGoods:{},checkedGoodsId:"",goodShow:!1,industry_name:"",selectRadioId:"",dateDays:"",limitsStatus:0,dataStart:"",dataEnd:""}},methods:{handleChange:function(e){switch(this.selectRadioId=e,console.log(e,"eeee"),e){case 2:this.industryVisible=!0;break;case 3:this.serviceVisible=!0,this.serviceSearch();break;case 4:this.goodsVisible=!0,this.goodsSearch();break;case 5:this.inventedVisible=!0,this.virGoodsSearch()}},dataChange:function(e){this.ruleForm.coupon_expire_type=e},dataStartChange:function(){this.ruleForm.coupon_expire.coupon_expire_start_time=this.dataStart},dataEndChange:function(){this.ruleForm.coupon_expire.coupon_expire_end_time=this.dataEnd},dateDaysChange:function(){this.ruleForm.coupon_expire.coupon_expire_start_time="",this.ruleForm.coupon_expire.coupon_expire_end_time=""},industrySure:function(){var e=this;""==this.industry_id?this.$alert("必须选择行业"):(console.log(this.industryForm,"industryForm"),console.log(this.industry_id,"industry_id"),this.ruleForm.coupon_range.category_id=this.industry_id,this.industryVisible=!1,this.industryForm.forEach(function(o){o.category_id==e.industry_id&&(e.industry_name=o.category_name,console.log(e.industry_name,"this.industry_name"))}))},goodsSure:function(){""==this.checkedGoodsId?(console.log(this.checkedGoodsId,"checkedGoodsId"),this.$alert("必须选择商品")):(console.log(this.checkedGoodsId,"checkedGoodsId"),this.ruleForm.coupon_range.goods_id=this.checkedGoodsId,this.goodsVisible=!1)},inventedSure:function(){console.log(this.checkedGoodsId,"222222222222"),""==this.checkedGoodsId?(console.log(this.checkedGoodsId,"checkedGoodsId1"),this.$alert("必须选择虚拟商品")):(console.log(this.checkedGoodsId,"checkedGoodsId2"),this.ruleForm.coupon_range.goods_id=this.checkedGoodsId,this.inventedVisible=!1)},serviceSure:function(){""==this.checkedGoodsId?(console.log(this.checkedGoodsId,"checkedGoodsId"),this.$alert("必须选择服务")):(console.log(this.checkedGoodsId,"checkedGoodsId"),this.ruleForm.coupon_range.goods_id=this.checkedGoodsId,this.serviceVisible=!1)},goodsSearch:function(){var e=this;console.log("商品搜索--------");var o=this.goods_name;this.$axios.get("/api/admin/select/goodsList?good_type=2&good_name="+o).then(function(o){0==o.data.code?(e.goodsList=o.data.data,e.goods_name=""):e.$message({message:o.data.msg,type:"warning"})})},serviceSearch:function(){var e=this;console.log("服务搜索----------");var o=this.goods_name;this.$axios.get("/api/admin/select/goodsList?good_type=1&good_name="+o).then(function(o){0==o.data.code?(e.goodsList=o.data.data,e.goods_name=""):e.$message({message:o.data.msg,type:"warning"})})},virGoodsSearch:function(){var e=this;console.log("虚拟商品搜索---------");var o=this.goods_name;this.$axios.get("/api/admin/select/goodsList?good_type=4&good_name="+o).then(function(o){0==o.data.code?(e.goodsList=o.data.data,e.goods_name=""):e.$message({message:o.data.msg,type:"warning"})})},submit:function(){var e=this,o=this.$route.params,t=JSON.parse(r()(this.ruleForm));t.rules.reduce_price=this.formatPrice(t.rules.reduce_price),t.rules.price=this.formatPrice(t.rules.price),s()(o).length?(this.ruleForm.coupon_code=o.coupon_code,this.$axios.post("/api/admin/coupon/edit",t).then(function(o){0==o.data.code?(e.$alert("编辑成功"),e.$router.push("/marketing/fullReducionCouponList")):e.$alert("接口返回错误")})):this.$axios.post("/api/admin/coupon/addReduce",t).then(function(o){0==o.data.code?(e.$alert("添加成功！"),e.$router.push("/marketing/fullReducionCouponList")):e.$alert(o.data.msg)}).catch(function(o){e.$alert("操作失败"+o)})},getCategoryList:function(){var e=this;this.$axios.get("/api/admin/select/categoryList").then(function(o){0==o.data.code&&(e.industryForm=o.data.data,console.log(e.industryForm,"industryForm"))})},formatPrice:function(e){return 100*e},formatPrice1:function(e){return e/100}},watch:{activeId:function(e){var o=this;console.log(this,"this"),this.$axios.get("/api/admin/select/goodsList?category_id="+this.industryForm[e].category_id+"&good_type="+this.selectRadioId).then(function(e){0==e.data.code&&(o.goodsList=e.data.data,console.log(o.goodsList,"goodsList"))})},radioGoodsId:function(e){var o=this;this.goodsList.forEach(function(t){t.good_id==e&&(o.checkedGoods=t,o.checkedGoodsId=t.good_id,console.log(o.checkedGoods,"checkedGoods"),o.goodShow=!0)})},radioServiceId:function(e){var o=this;this.goodsList.forEach(function(t){t.good_id==e&&(o.checkedGoods=t,o.checkedGoodsId=t.good_id,console.log(o.checkedGoods,"checkedGoods"),o.goodShow=!0)})}},mounted:function(){},components:{BreadCrumb:t("tVcc").a},created:function(){var e=this;this.getCategoryList();var o=this.$route.params;s()(o).length&&this.$axios.get("/api/admin/coupon/info",{params:o}).then(function(o){if(0==o.data.code){0==o.data.data.limits.limit_times?e.limitsStatus=0:e.limitsStatus=1,console.log(e.limitsStatus,"limitsStatus");var t=JSON.parse(r()(o.data.data));t.rules.reduce_price=e.formatPrice1(t.rules.reduce_price),t.rules.price=e.formatPrice1(t.rules.price),e.dataStart=t.coupon_expire.coupon_expire_start_time,e.dataEnd=t.coupon_expire.coupon_expire_end_time,e.ruleForm=t}else e.$alert("接口返回错误")})},computed:{}},d={render:function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"page"},[t("div",{staticClass:"page-header"},[t("div",{staticClass:"crumbs"},[t("bread-crumb",{attrs:{"bread-crumb":e.breadcrumb}})],1)]),e._v(" "),t("div",{staticClass:"page-content"},[t("div",{staticClass:"panel coupon-apnel"},[t("el-form",{staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"120px"}},[t("el-form-item",{attrs:{label:"优惠券标题:",prop:"coupon_title"}},[t("el-col",{attrs:{span:12}},[t("el-input",{model:{value:e.ruleForm.coupon_title,callback:function(o){e.$set(e.ruleForm,"coupon_title",o)},expression:"ruleForm.coupon_title"}})],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"面值:"}},[t("el-col",{attrs:{span:12}},[t("el-input",{model:{value:e.ruleForm.rules.reduce_price,callback:function(o){e.$set(e.ruleForm.rules,"reduce_price",o)},expression:"ruleForm.rules.reduce_price"}})],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"可使用次数:"}},[t("el-col",{attrs:{span:3}},[t("el-input",{model:{value:e.ruleForm.limits.limit_total_times,callback:function(o){e.$set(e.ruleForm.limits,"limit_total_times",o)},expression:"ruleForm.limits.limit_total_times"}})],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"可使用频率:"}},[t("el-col",{attrs:{span:5}},[t("el-radio-group",{model:{value:e.limitsStatus,callback:function(o){e.limitsStatus=o},expression:"limitsStatus"}},[t("el-radio",{attrs:{label:0}},[e._v("不限")]),e._v(" "),t("el-radio",{attrs:{label:1}},[e._v("限制")])],1)],1),e._v(" "),t("el-col",{attrs:{span:4}},[t("span",[e._v("每")]),e._v(" "),t("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择"},model:{value:e.ruleForm.limits.limit_cycle,callback:function(o){e.$set(e.ruleForm.limits,"limit_cycle",o)},expression:"ruleForm.limits.limit_cycle"}},[t("el-option",{attrs:{label:"日",value:"1"}}),e._v(" "),t("el-option",{attrs:{label:"周",value:"2"}}),e._v(" "),t("el-option",{attrs:{label:"月",value:"3"}})],1)],1),e._v(" "),t("el-col",{attrs:{span:4}},[t("el-input",{staticStyle:{width:"100px"},model:{value:e.ruleForm.limits.limit_times,callback:function(o){e.$set(e.ruleForm.limits,"limit_times",o)},expression:"ruleForm.limits.limit_times"}}),t("span",[e._v("次")])],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"最低消费:"}},[t("el-col",{attrs:{span:5}},[t("el-radio-group",{model:{value:e.ruleForm.rules.is_full,callback:function(o){e.$set(e.ruleForm.rules,"is_full",o)},expression:"ruleForm.rules.is_full"}},[t("el-radio",{attrs:{label:0}},[e._v("无门槛")]),e._v(" "),t("el-radio",{attrs:{label:1}},[e._v("满")])],1)],1),e._v(" "),t("el-col",{attrs:{span:5}},[t("el-input",{staticStyle:{width:"100px"},model:{value:e.ruleForm.rules.price,callback:function(o){e.$set(e.ruleForm.rules,"price",o)},expression:"ruleForm.rules.price"}}),t("span",[e._v("元可用")])],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"使用范围:"}},[t("el-radio-group",{on:{change:e.handleChange},model:{value:e.ruleForm.coupon_range_type,callback:function(o){e.$set(e.ruleForm,"coupon_range_type",o)},expression:"ruleForm.coupon_range_type"}},[t("el-radio",{attrs:{label:1}},[e._v("通用")]),e._v(" "),t("el-radio",{attrs:{label:2}},[e._v("指定行业")]),e._v(" "),t("el-radio",{attrs:{label:3}},[e._v("指定服务")]),e._v(" "),t("el-radio",{attrs:{label:4}},[e._v("指定商品")]),e._v(" "),t("el-radio",{attrs:{label:5}},[e._v("指定虚拟商品")])],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"使用规则:"}},[t("el-col",{attrs:{span:18}},[t("el-input",{attrs:{type:"textarea",rows:6,placeholder:"请输入内容"},model:{value:e.ruleForm.coupon_desc,callback:function(o){e.$set(e.ruleForm,"coupon_desc",o)},expression:"ruleForm.coupon_desc"}})],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"活动专属:"}},[t("el-col",{attrs:{span:6}},[t("el-radio-group",{model:{value:e.ruleForm.coupon_in_shop,callback:function(o){e.$set(e.ruleForm,"coupon_in_shop",o)},expression:"ruleForm.coupon_in_shop"}},[t("el-radio",{attrs:{label:1}},[e._v("否")]),e._v(" "),t("el-radio",{attrs:{label:2}},[e._v("是")])],1)],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"使用有效期:"}},[t("el-col",{attrs:{span:24}},[t("el-radio-group",{on:{change:e.dataChange},model:{value:e.ruleForm.coupon_expire_type,callback:function(o){e.$set(e.ruleForm,"coupon_expire_type",o)},expression:"ruleForm.coupon_expire_type"}},[t("el-radio",{attrs:{label:1}},[e._v("固定日期\n                                "),e._v(" "),t("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间","value-format":"yyyy-MM-dd hh:mm:ss",align:"right","picker-options":e.pickerOptions},on:{change:e.dataStartChange},model:{value:e.dataStart,callback:function(o){e.dataStart=o},expression:"dataStart"}}),e._v("\n                                至\n                                "),t("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间","value-format":"yyyy-MM-dd hh:mm:ss",align:"right","picker-options":e.pickerOptions},on:{change:e.dataEndChange},model:{value:e.dataEnd,callback:function(o){e.dataEnd=o},expression:"dataEnd"}})],1),e._v(" "),t("div",{staticClass:"heigth20px"}),e._v(" "),t("el-radio",{attrs:{label:2}},[e._v("领取当日开始\n                                "),t("el-input",{on:{blur:e.dateDaysChange},model:{value:e.ruleForm.coupon_expire.coupon_expire_day,callback:function(o){e.$set(e.ruleForm.coupon_expire,"coupon_expire_day",o)},expression:"ruleForm.coupon_expire.coupon_expire_day"}}),e._v("\n                                天内有效\n                            ")],1)],1)],1)],1),e._v(" "),t("div",[2==e.ruleForm.coupon_range_type?t("div",{staticClass:"pd-left"},[t("span",[e._v("已选:"+e._s(e.industry_name))])]):e._e(),e._v(" "),3==e.ruleForm.coupon_range_type?t("div",{staticClass:"pd-left"},[t("span",[e._v("已选:"+e._s(e.checkedGoods.good_name)+" "),e.checkedGoods.good_ico?t("img",{attrs:{src:e.checkedGoods.good_ico,width:"40px",height:"40px"}}):e._e()])]):e._e(),e._v(" "),4==e.ruleForm.coupon_range_type?t("div",[t("span",[e._v("已选:"+e._s(e.checkedGoods.good_name)+" "),e.checkedGoods.good_ico?t("img",{attrs:{src:e.checkedGoods.good_ico,width:"40px",height:"40px"}}):e._e()])]):e._e(),e._v(" "),5==e.ruleForm.coupon_range_type?t("div",[t("span",[e._v("已选:"+e._s(e.checkedGoods.good_name)+" "),e.checkedGoods.good_ico?t("img",{attrs:{src:e.checkedGoods.good_ico,width:"40px",height:"40px"}}):e._e()])]):e._e()]),e._v(" "),t("el-dialog",{attrs:{title:"行业列表",visible:e.industryVisible},on:{"update:visible":function(o){e.industryVisible=o}}},[t("el-form-item",{attrs:{label:"行业"}},[t("el-select",{attrs:{placeholder:"请选择所属行业分类"},model:{value:e.industry_id,callback:function(o){e.industry_id=o},expression:"industry_id"}},e._l(e.industryForm,function(e){return t("el-option",{key:e.category_id+"category_id",attrs:{label:e.category_name,value:e.category_id}})}))],1),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.industrySure}},[e._v("确 定")])],1)],1),e._v(" "),t("el-dialog",{attrs:{title:"选择指定服务",visible:e.goodsVisible},on:{"update:visible":function(o){e.goodsVisible=o}}},[t("el-form-item",[e.goodShow?t("div",{staticClass:"good_show"},[t("el-radio",{attrs:{label:e.checkedGoods.good_id},model:{value:e.checkedGoodsId,callback:function(o){e.checkedGoodsId=o},expression:"checkedGoodsId"}},[t("img",{attrs:{src:e.checkedGoods.good_ico,width:"30px",height:"30px"}}),e._v(e._s(e.checkedGoods.good_name))])],1):e._e(),e._v(" "),t("el-col",{attrs:{span:12}},[t("el-input",{attrs:{placeholder:"搜索"},model:{value:e.goods_name,callback:function(o){e.goods_name=o},expression:"goods_name"}})],1),e._v(" "),t("el-col",{staticStyle:{"text-indent":"8px"},attrs:{span:5}},[t("el-button",{attrs:{type:"primary"},on:{click:e.goodsSearch}},[e._v("查询")])],1)],1),e._v(" "),t("el-tabs",{staticStyle:{height:"200px"},attrs:{type:"border-card","tab-position":e.tabPosition},model:{value:e.activeId,callback:function(o){e.activeId=o},expression:"activeId"}},e._l(e.industryForm,function(o){return t("el-tab-pane",{attrs:{label:o.category_name,value:o.category_id}},e._l(e.goodsList,function(o){return t("p",{key:o.good_id,staticClass:"line-hidden"},[t("el-radio",{attrs:{label:o.good_id},model:{value:e.radioGoodsId,callback:function(o){e.radioGoodsId=o},expression:"radioGoodsId"}},[t("img",{attrs:{src:o.good_ico,width:"20px",height:"20px"}}),t("span",{staticClass:"ml6"},[e._v(e._s(o.good_name))])])],1)}))})),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.goodsSure}},[e._v("确 定")])],1)],1),e._v(" "),t("el-dialog",{attrs:{title:"选择指定商品",visible:e.serviceVisible},on:{"update:visible":function(o){e.serviceVisible=o}}},[t("el-form-item",[e.goodShow?t("div",{staticClass:"good_show"},[t("el-radio",{attrs:{label:e.checkedGoods.good_id},model:{value:e.checkedGoodsId,callback:function(o){e.checkedGoodsId=o},expression:"checkedGoodsId"}},[t("img",{attrs:{src:e.checkedGoods.good_ico,width:"30px",height:"30px"}}),t("span",{staticClass:"ml6"},[e._v(e._s(e.checkedGoods.good_name))])])],1):e._e(),e._v(" "),t("el-col",{attrs:{span:12}},[t("el-input",{attrs:{placeholder:"搜索"},model:{value:e.goods_name,callback:function(o){e.goods_name=o},expression:"goods_name"}})],1),e._v(" "),t("el-col",{staticStyle:{"text-indent":"8px"},attrs:{span:5}},[t("el-button",{attrs:{type:"primary"},on:{click:e.serviceSearch}},[e._v("查询")])],1)],1),e._v(" "),t("el-tabs",{staticStyle:{height:"200px"},attrs:{type:"border-card","tab-position":e.tabPosition},model:{value:e.activeId,callback:function(o){e.activeId=o},expression:"activeId"}},e._l(e.industryForm,function(o){return t("el-tab-pane",{attrs:{label:o.category_name,value:o.category_id}},e._l(e.goodsList,function(o){return t("p",{key:o.good_id,staticClass:"line-hidden"},[t("el-radio",{attrs:{label:o.good_id},model:{value:e.radioServiceId,callback:function(o){e.radioServiceId=o},expression:"radioServiceId"}},[t("img",{attrs:{src:o.good_ico,width:"30px",height:"30px"}}),t("span",{staticClass:"ml6"},[e._v(e._s(o.good_name))])])],1)}))})),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.serviceSure}},[e._v("确 定")])],1)],1),e._v(" "),t("el-dialog",{attrs:{title:"选择虚拟商品",visible:e.inventedVisible},on:{"update:visible":function(o){e.inventedVisible=o}}},[t("el-form-item",[e.goodShow?t("div",{staticClass:"good_show"},[t("el-radio",{attrs:{label:e.checkedGoods.good_id},model:{value:e.checkedGoodsId,callback:function(o){e.checkedGoodsId=o},expression:"checkedGoodsId"}},[t("img",{attrs:{src:e.checkedGoods.good_ico,width:"30px",height:"30px"}}),e._v(e._s(e.checkedGoods.good_name))])],1):e._e(),e._v(" "),t("el-col",{attrs:{span:12}},[t("el-input",{attrs:{placeholder:"搜索"},model:{value:e.goods_name,callback:function(o){e.goods_name=o},expression:"goods_name"}})],1),e._v(" "),t("el-col",{staticStyle:{"text-indent":"8px"},attrs:{span:5}},[t("el-button",{attrs:{type:"primary"},on:{click:e.virGoodsSearch}},[e._v("查询")])],1)],1),e._v(" "),t("el-tabs",{staticStyle:{height:"200px"},attrs:{type:"border-card","tab-position":e.tabPosition},model:{value:e.activeId,callback:function(o){e.activeId=o},expression:"activeId"}},e._l(e.industryForm,function(o){return t("el-tab-pane",{attrs:{label:o.category_name,value:o.category_id}},e._l(e.goodsList,function(o){return t("p",{key:o.good_id,staticClass:"line-hidden"},[t("img",{attrs:{src:o.good_ico,width:"30px",height:"30px"}}),t("el-radio",{attrs:{label:o.good_id},model:{value:e.radioServiceId,callback:function(o){e.radioServiceId=o},expression:"radioServiceId"}},[t("span",{staticClass:"ml6"},[e._v(e._s(o.good_name))])])],1)}))})),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.inventedSure}},[e._v("确 定")])],1)],1),e._v(" "),t("el-form-item",{staticClass:"margin-auto"},[t("el-button",{attrs:{size:"large",type:"primary"},on:{click:function(o){e.submit()}}},[e._v("提交")])],1)],1)],1)])])},staticRenderFns:[]};var c=t("VU/8")(l,d,!1,function(e){t("c+E0")},"data-v-0fc63da0",null);o.default=c.exports},"c+E0":function(e,o){}});