webpackJsonp([6],{JTwK:function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=e("fZjL"),o=e.n(s),a={name:"tabletest",data:function(){return{index:"",gitfNumber:"",radioGoodsId:"",goodShow:!1,goodsVisible:!1,goodsDefaultVisible:!1,imageUrl:"",dialogImageUrl:"",limitsStatus:0,date:"",activeId:"",goodsList:{},checkedGoods:{},checkedGoodsId:"",tabPosition:"left",limit_total_times:"",step:1,industryForm:[{name:"通用券",type:1},{name:"行业券",type:2},{name:"服务券",type:3},{name:"商品券",type:4},{name:"虚拟商品券",type:5}],itemLIst:[{name:"奖品",index:1},{name:"奖品图",index:2},{name:"奖品数量",index:3},{name:"中奖率",index:4}],breadcrumb:[{name:"营销管理/营销应用",url:"/marketing/markList"},{name:"摇一摇",url:"/marketing/shake/list"},{name:"添加"}],ruleForm:{activity_title:"",activity_subject:"",activity_desc:"",activity_img:"",activity_status:2,activity_start_time:"",activity_end_time:"",limits:{limit_total_times:"",limit_times:""},rules:{shake_default:{coupon_code:"",coupon_title:"",coupon_img:"",price:"",reduce_price:"",gifts_img:""},shakes:[{index:0,coupon_code:"",coupon_title:"",coupon_img:"",price:"",reduce_price:"",gifts_img:"",gifts_num:null,gifts_probability:null},{index:1,coupon_code:"",coupon_title:"",coupon_img:"",price:"",reduce_price:"",gifts_img:"",gifts_num:null,gifts_probability:null},{index:2,coupon_code:"",coupon_title:"",coupon_img:"",price:"",reduce_price:"",gifts_img:"",gifts_num:null,gifts_probability:null},{index:3,coupon_code:"",coupon_title:"",coupon_img:"",price:"",reduce_price:"",gifts_img:"",gifts_num:null,gifts_probability:null},{index:4,coupon_code:"",coupon_title:"",coupon_img:"",price:"",reduce_price:"",gifts_img:"",gifts_num:null,gifts_probability:null},{index:5,coupon_code:"",coupon_title:"",coupon_img:"",price:"",reduce_price:"",gifts_img:"",gifts_num:null,gifts_probability:null},{index:6,coupon_code:"",coupon_title:"",coupon_img:"",price:"",reduce_price:"",gifts_img:"",gifts_num:null,gifts_probability:null},{index:7,coupon_code:"",coupon_title:"",coupon_img:"",price:"",reduce_price:"",gifts_img:"",gifts_num:null,gifts_probability:null}]}},rules:{activity_title:[{required:!0,message:"请输入活动名称",trigger:"blur"}],activity_subject:[{required:!0,message:"请输入活动描述",trigger:"blur"}],activity_desc:[{required:!0,message:"请输入活动卖点",trigger:"blur"}]}}},methods:{defaultChoice:function(){this.goodsDefaultVisible=!0},goodsDefaultSure:function(){""==this.checkedGoodsId?(console.log(this.checkedGoodsId,"checkedGoodsId"),this.$alert("必须选择商品")):(this.ruleForm.rules.shake_default.coupon_code=this.checkedGoodsId,this.ruleForm.rules.shake_default.coupon_title=this.checkedGoods.coupon_title,this.ruleForm.rules.shake_default.coupon_img=this.checkedGoods.coupon_img,this.ruleForm.rules.shake_default.price=this.checkedGoods.price,this.ruleForm.rules.shake_default.reduce_price=this.checkedGoods.reduce_price,this.goodsDefaultVisible=!1)},goodsSure:function(){""==this.checkedGoodsId?(console.log(this.checkedGoodsId,"checkedGoodsId"),this.$alert("必须选择商品")):(this.ruleForm.rules.shakes[this.index].coupon_code=this.checkedGoodsId,this.ruleForm.rules.shakes[this.index].coupon_title=this.checkedGoods.coupon_title,this.ruleForm.rules.shakes[this.index].coupon_img=this.checkedGoods.coupon_img,this.ruleForm.rules.shakes[this.index].price=this.checkedGoods.rules.price,this.ruleForm.rules.shakes[this.index].reduce_price=this.checkedGoods.rules.reduce_price,this.goodsVisible=!1)},goodsCancal:function(){this.goodsVisible=!1},choiceClick:function(t){this.index=t,this.goodsVisible=!0},show_img:function(t,i,e){this.ruleForm.rules.shakes[t.data.index].gifts_img=i.data.url},show_default_img:function(t){this.ruleForm.rules.shake_default.gifts_img=t.data.url},uploadActivityImg:function(t){this.ruleForm.activity_img=t.data.url},limitsChange:function(t){0==t?(this.ruleForm.limits.limit_total_times=this.limit_total_times,console.log("00000")):(this.ruleForm.limits.limit_total_times=0,console.log("11111"))},handleFaceUploadSuccess:function(){},goNextStep:function(t){this.step=t},getGoodsList:function(){var t=this;this.$axios.get("/api/admin/select/coupon?type=1").then(function(i){0==i.data.code&&(t.goodsList=i.data.data)})},submit:function(){var t=this,i=this.$route.params;this.ruleForm.activity_code=i.activity_code,o()(i).length?this.$axios.post("/api/admin/activity/edit",this.ruleForm).then(function(i){0==i.data.code?(t.$alert(i.data.msg),t.$router.push("/marketing/shake/list")):t.$alert(i.data.msg)}).catch(function(i){t.$alert("操作失败"+i)}):(console.log(this.ruleForm,"choiceLIst"),this.$axios.post("/api/admin/activity/addShake",this.ruleForm).then(function(i){0==i.data.code?(t.$alert(i.data.msg),t.$router.push("/marketing/shake/list")):t.$alert(i.data.msg)}).catch(function(i){t.$alert("操作失败"+i)}))}},watch:{activeId:function(t){var i=this;t=Number(t)+1,console.log(t,"val"),this.$axios.get("/api/admin/select/coupon?type="+t).then(function(t){0==t.data.code&&(i.goodsList=t.data.data)})},radioGoodsId:function(t){var i=this;this.goodsList.forEach(function(e){e.coupon_code==t&&(i.checkedGoods=e,i.checkedGoodsId=e.coupon_code,console.log(i.checkedGoods,"checkedGoods"),i.goodShow=!0)})}},mounted:function(){},components:{BreadCrumb:e("tVcc").a},created:function(){var t=this;console.log(this.$route.params,"this.$route.params");var i=this.$route.params;o()(i).length&&(this.params=i,console.log(i,"params"),this.$axios.post("/api/admin/activity/info",i).then(function(i){0==i.data.code&&(t.ruleForm=i.data.data,0==i.data.data.limits.limit_total_times?t.limitsStatus=0:t.limitsStatus=1)})),this.getGoodsList()},computed:{}},l={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"page"},[e("div",{staticClass:"page-header"},[e("div",{staticClass:"crumbs"},[e("bread-crumb",{attrs:{"bread-crumb":t.breadcrumb}})],1)]),t._v(" "),e("div",{staticClass:"page-content"},[e("el-steps",{attrs:{active:t.step,simple:""}},[e("el-step",{attrs:{title:"编辑基本信息",icon:"el-icon-edit"},nativeOn:{click:function(i){t.goNextStep(1)}}}),t._v(" "),e("el-step",{attrs:{title:"编辑详情信息",icon:"el-icon-edit"},nativeOn:{click:function(i){t.goNextStep(2)}}})],1),t._v(" "),e("div",{staticClass:"panel "},[1==t.step?e("div",{staticClass:"form-panel p-xl "},[e("el-form",{ref:"ruleForm1",staticClass:"demo-ruleForm width720",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"活动名称：",prop:"activity_title"}},[e("el-input",{model:{value:t.ruleForm.activity_title,callback:function(i){t.$set(t.ruleForm,"activity_title",i)},expression:"ruleForm.activity_title"}})],1),t._v(" "),e("el-form-item",{attrs:{label:"活动卖点：",prop:"activity_subject"}},[e("el-input",{model:{value:t.ruleForm.activity_subject,callback:function(i){t.$set(t.ruleForm,"activity_subject",i)},expression:"ruleForm.activity_subject"}})],1),t._v(" "),e("el-form-item",{attrs:{label:"封面图："}},[e("el-upload",{staticClass:"avatar-uploader",attrs:{action:"/api/admin/fileupload/image","show-file-list":!1,"on-success":t.uploadActivityImg}},[t.ruleForm.activity_img?e("img",{staticClass:"avatar",attrs:{src:t.ruleForm.activity_img}}):e("i",{staticClass:"el-icon-plus avatar-uploader-icon",staticStyle:{"font-size":"48px","margin-top":"15%"}})]),t._v(" "),e("div",{staticClass:"upload-title"},[e("p",{staticClass:"upload-title-red"},[t._v("支持上传一张图片，图片宽高比为1242*1242，支持JPEG、PNG 等大部分图片格式")])])],1),t._v(" "),e("el-form-item",{attrs:{label:"活动规则：",prop:"activity_desc"}},[e("el-input",{attrs:{type:"textarea",rows:"7"},model:{value:t.ruleForm.activity_desc,callback:function(i){t.$set(t.ruleForm,"activity_desc",i)},expression:"ruleForm.activity_desc"}})],1),t._v(" "),e("el-form-item",[e("el-button",{attrs:{size:"large",type:"primary"},on:{click:function(i){t.goNextStep(2)}}},[t._v("下一步")])],1)],1)],1):t._e(),t._v(" "),2==t.step?e("div",{staticClass:"form-panel p-xl width720"},[e("el-form",{ref:"ruleForm2",staticClass:"demo-ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"160px"}},[e("el-form-item",{attrs:{label:"开始时间："}},[e("el-col",{attrs:{span:10}},[e("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd"},model:{value:t.ruleForm.activity_start_time,callback:function(i){t.$set(t.ruleForm,"activity_start_time",i)},expression:"ruleForm.activity_start_time"}})],1),t._v(" "),e("el-col",{staticClass:"line-center",attrs:{span:4}},[t._v("至")]),t._v(" "),e("el-col",{attrs:{span:10}},[e("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd"},model:{value:t.ruleForm.activity_end_time,callback:function(i){t.$set(t.ruleForm,"activity_end_time",i)},expression:"ruleForm.activity_end_time"}})],1)],1),t._v(" "),e("el-form-item",{attrs:{label:"每人每天可参与："}},[e("el-col",{attrs:{span:12}},[e("el-input",{attrs:{placeholder:"请输入"},model:{value:t.ruleForm.limits.limit_times,callback:function(i){t.$set(t.ruleForm.limits,"limit_times",i)},expression:"ruleForm.limits.limit_times"}}),e("span")],1),t._v(" "),e("el-col",{staticClass:"line-center",attrs:{span:4}},[e("span",[t._v("次")])])],1),t._v(" "),e("el-form-item",{attrs:{label:"活动期间一共可参与："}},[e("el-radio-group",{on:{change:t.limitsChange},model:{value:t.limitsStatus,callback:function(i){t.limitsStatus=i},expression:"limitsStatus"}},[e("el-col",{attrs:{span:12}},[e("div",{staticClass:"limit-no"},[e("el-radio",{attrs:{label:0}},[t._v("不限")])],1)]),t._v(" "),e("el-col",{attrs:{span:12}},[e("el-radio",{attrs:{label:1}},[t._v("限制"),e("el-input",{model:{value:t.ruleForm.limits.limit_total_times,callback:function(i){t.$set(t.ruleForm.limits,"limit_total_times",i)},expression:"ruleForm.limits.limit_total_times"}}),t._v("次")],1)],1)],1)],1)],1),t._v(" "),e("p",{staticClass:"gift-title"},[t._v("设置奖品")]),t._v(" "),e("p",{staticClass:"gift-title"},[t._v("以下奖品必须全部选择，否则无法上架")]),t._v(" "),e("div",{staticClass:"gift-table left0 width980"},[e("div",{staticClass:"table-th"},t._l(t.itemLIst,function(i){return e("div",{key:i.index,staticClass:"th-item"},[t._v(t._s(i.name))])})),t._v(" "),t._l(t.ruleForm.rules.shakes,function(i){return e("div",{key:i.index,staticClass:"table-body mt10 mb10"},[e("div",{staticClass:"body-gift-choice body-item"},[e("div",{staticClass:"item-choice"},[i.coupon_code?e("div",{staticClass:"choiced"},[e("div",{staticClass:"goods-div "},[e("div",{staticClass:"goods-div-left"},[e("p",{staticClass:"margin-top10"},[e("span",{staticClass:"price"},[t._v("¥"+t._s(i.reduce_price/100))]),e("span",[t._v(t._s(i.coupon_title))])]),t._v(" "),e("p",{staticClass:"margin-top10"},[t._v("满"+t._s(i.price/100)+"元可用")])]),t._v(" "),e("div",{staticClass:"goods-div-right"},[i.coupon_img?e("img",{attrs:{src:i.coupon_img,width:"70px",height:"70px"}}):e("p",{staticClass:"no-img"},[t._v("暂无图片")])])])]):e("div",{staticClass:"choice-button",on:{click:function(e){t.choiceClick(i.index)}}},[t._v("请选择")])])]),t._v(" "),e("div",{staticClass:"body-gift-img body-item"},[e("div",{staticClass:"item-upload marking-upload"},[e("el-upload",{staticClass:"avatar-uploader",attrs:{action:"/api/admin/fileupload/image","show-file-list":!1,"on-success":t.show_img.bind(null,{data:i}),data:i}},[i.gifts_img?e("img",{attrs:{width:"178px","max-width":"178px",height:"96px","max-height":"96px",src:i.gifts_img}}):e("div",{staticClass:"upload-img-icon"},[e("i",{staticClass:"el-icon-plus position-icon",staticStyle:{"font-size":"48px"}})])])],1)]),t._v(" "),e("div",{staticClass:"body-gift-number body-item"},[e("div",{staticClass:"item-number"},[e("input",{directives:[{name:"model",rawName:"v-model",value:i.gifts_num,expression:"item.gifts_num"}],staticClass:"number-input",attrs:{type:"text"},domProps:{value:i.gifts_num},on:{input:function(e){e.target.composing||t.$set(i,"gifts_num",e.target.value)}}})])]),t._v(" "),e("div",{staticClass:"body-gift-text body-item"},[e("div",{staticClass:"item-text"},[e("input",{directives:[{name:"model",rawName:"v-model",value:i.gifts_probability,expression:"item.gifts_probability"}],staticClass:"text-input",attrs:{type:"text"},domProps:{value:i.gifts_probability},on:{input:function(e){e.target.composing||t.$set(i,"gifts_probability",e.target.value)}}})])])])})],2),t._v(" "),e("p",{staticClass:"gift-title"},[t._v(" 设置安慰奖")]),t._v(" "),e("p",{staticClass:"gift-title"},[t._v("安慰奖必须选择，否则无法上架")]),t._v(" "),e("div",{staticClass:"gift-table left0 "},[t._m(0),t._v(" "),e("div",{staticClass:"table-body"},[e("div",{staticClass:"comfort-left comfort-item"},[t.ruleForm.rules.shake_default.coupon_code?e("div",{staticClass:"choiced"},[e("div",{staticClass:"goods-div "},[e("div",{staticClass:"goods-div-left"},[e("p",{staticClass:"margin-top10"},[e("span",{staticClass:"price"},[t._v("¥"+t._s(t.ruleForm.rules.shake_default.reduce_price/100))]),e("span",[t._v(t._s(t.ruleForm.rules.shake_default.coupon_title))])]),t._v(" "),e("p",{staticClass:"margin-top10"},[t._v("满"+t._s(t.ruleForm.rules.shake_default.price/100)+"元可用")])]),t._v(" "),e("div",{staticClass:"goods-div-right"},[t.ruleForm.rules.shake_default.coupon_img?e("img",{attrs:{src:t.ruleForm.rules.shake_default.coupon_img,width:"70px",height:"70px"}}):e("p",{staticClass:"no-img"},[t._v("暂无图片")])])])]):e("div",{staticClass:"comfort-button",on:{click:function(i){t.defaultChoice()}}},[t._v("请选择")])]),t._v(" "),e("div",{staticClass:"comfort-right comfort-item"},[e("el-upload",{staticClass:"avatar-uploader",attrs:{action:"/api/admin/fileupload/image","show-file-list":!1,"on-success":t.show_default_img}},[t.ruleForm.rules.shake_default.gifts_img?e("img",{attrs:{width:"358px",height:"96px",src:t.ruleForm.rules.shake_default.gifts_img}}):e("div",{staticClass:"upload-img-icon"},[e("i",{staticClass:"el-icon-plus position-icon",staticStyle:{"font-size":"48px"}})])])],1)])]),t._v(" "),e("el-form",{ref:"ruleForm3",staticClass:"bottom-form",attrs:{model:t.ruleForm}},[e("el-form-item",{attrs:{label:"状态："}},[e("el-radio-group",{model:{value:t.ruleForm.activity_status,callback:function(i){t.$set(t.ruleForm,"activity_status",i)},expression:"ruleForm.activity_status"}},[e("el-radio",{attrs:{label:1}},[t._v("下架")]),t._v(" "),e("el-radio",{attrs:{label:2}},[t._v("上架")])],1)],1),t._v(" "),e("div",{staticClass:"finish"},[e("el-button",{attrs:{size:"large",type:"primary"},on:{click:function(i){t.goNextStep(1)}}},[t._v("上一步")]),t._v(" "),e("el-button",{attrs:{size:"large",type:"primary"},on:{click:t.submit}},[t._v("上架")])],1),t._v(" "),e("div",{staticClass:"tab-overflow shake-box"},[e("el-dialog",{attrs:{title:"选择指定商品",visible:t.goodsVisible},on:{"update:visible":function(i){t.goodsVisible=i}}},[e("el-form-item",[t.goodShow?e("div",{staticClass:"good_show"},[e("el-radio",{attrs:{label:t.checkedGoods.coupon_code},model:{value:t.checkedGoodsId,callback:function(i){t.checkedGoodsId=i},expression:"checkedGoodsId"}},[e("div",{staticClass:"goods-div "},[e("div",{staticClass:"goods-div-left"},[e("p",{staticClass:"margin-top10"},[e("span",{staticClass:"price"},[t._v("¥"+t._s(t.checkedGoods.rules.reduce_price/100))]),e("span",[t._v(t._s(t.checkedGoods.coupon_title))])]),t._v(" "),e("p",{staticClass:"margin-top10"},[t._v("满"+t._s(t.checkedGoods.rules.price/100)+"元可用")])]),t._v(" "),e("div",{staticClass:"goods-div-right"},[t.checkedGoods.coupon_img?e("img",{attrs:{src:t.checkedGoods.coupon_img,width:"70px",height:"70px"}}):e("p",{staticClass:"no-img"},[t._v("暂无图片")])])])])],1):t._e()]),t._v(" "),e("el-tabs",{staticStyle:{height:"200px"},attrs:{type:"border-card","tab-position":t.tabPosition},model:{value:t.activeId,callback:function(i){t.activeId=i},expression:"activeId"}},t._l(t.industryForm,function(i){return e("el-tab-pane",{key:i.type+"type",attrs:{label:i.name,value:i.type}},t._l(t.goodsList,function(i){return e("el-radio",{key:i.coupon_code,attrs:{label:i.coupon_code},model:{value:t.radioGoodsId,callback:function(i){t.radioGoodsId=i},expression:"radioGoodsId"}},[e("div",{staticClass:"goods-div "},[e("div",{staticClass:"goods-div-left"},[e("p",{staticClass:"margin-top10"},[e("span",{staticClass:"price"},[t._v("¥"+t._s(i.rules.reduce_price/100))]),e("span",[t._v(t._s(i.coupon_title))])]),t._v(" "),e("p",{staticClass:"margin-top10"},[t._v("满"+t._s(i.rules.price/100)+"元可用")])]),t._v(" "),e("div",{staticClass:"goods-div-right"},[i.coupon_img?e("img",{attrs:{src:i.coupon_img,width:"70px",height:"70px"}}):e("p",{staticClass:"no-img"},[t._v("暂无图片")])])])])}))})),t._v(" "),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.goodsCancal}},[t._v("取 消")]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:t.goodsSure}},[t._v("确 定")])],1)],1),t._v(" "),e("el-dialog",{staticClass:"shake-box",attrs:{title:"选择指定商品",visible:t.goodsDefaultVisible},on:{"update:visible":function(i){t.goodsDefaultVisible=i}}},[e("el-form-item",[t.goodShow?e("div",{staticClass:"good_show"},[e("el-radio",{attrs:{label:t.checkedGoods.coupon_code},model:{value:t.checkedGoodsId,callback:function(i){t.checkedGoodsId=i},expression:"checkedGoodsId"}},[e("div",{staticClass:"goods-div "},[e("div",{staticClass:"goods-div-left"},[e("p",{staticClass:"margin-top10"},[e("span",{staticClass:"price"},[t._v("¥"+t._s(t.checkedGoods.rules.reduce_price/100))]),e("span",[t._v(t._s(t.checkedGoods.coupon_title))])]),t._v(" "),e("p",{staticClass:"margin-top10"},[t._v("满"+t._s(t.checkedGoods.rules.price/100)+"元可用")])]),t._v(" "),e("div",{staticClass:"goods-div-right"},[t.checkedGoods.coupon_img?e("img",{attrs:{src:t.checkedGoods.coupon_img,width:"70px",height:"70px"}}):e("p",{staticClass:"no-img"},[t._v("暂无图片")])])])])],1):t._e()]),t._v(" "),e("el-tabs",{staticStyle:{height:"200px"},attrs:{type:"border-card","tab-position":t.tabPosition},model:{value:t.activeId,callback:function(i){t.activeId=i},expression:"activeId"}},t._l(t.industryForm,function(i){return e("el-tab-pane",{key:i.type+"type",attrs:{label:i.name,value:i.type}},t._l(t.goodsList,function(i){return e("el-radio",{key:i.coupon_code,attrs:{label:i.coupon_code},model:{value:t.radioGoodsId,callback:function(i){t.radioGoodsId=i},expression:"radioGoodsId"}},[e("div",{staticClass:"goods-div "},[e("div",{staticClass:"goods-div-left"},[e("p",{staticClass:"margin-top10"},[e("span",{staticClass:"price"},[t._v("¥"+t._s(i.rules.reduce_price/100))]),e("span",[t._v(t._s(i.coupon_title))])]),t._v(" "),e("p",{staticClass:"margin-top10"},[t._v("满"+t._s(i.rules.price/100)+"元可用")])]),t._v(" "),e("div",{staticClass:"goods-div-right"},[i.coupon_img?e("img",{attrs:{src:i.coupon_img,width:"70px",height:"70px"}}):e("p",{staticClass:"no-img"},[t._v("暂无图片")])])])])}))})),t._v(" "),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.goodsCancal}},[t._v("取 消")]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:t.goodsDefaultSure}},[t._v("确 定")])],1)],1)],1)],1)],1):t._e()])],1)])},staticRenderFns:[function(){var t=this.$createElement,i=this._self._c||t;return i("div",{staticClass:"table-th"},[i("div",{staticClass:"th-item"},[this._v("奖品")]),this._v(" "),i("div",{staticClass:"th-item"},[this._v("奖品图")])])}]};var c=e("VU/8")(a,l,!1,function(t){e("xC3x")},"data-v-813c0b16",null);i.default=c.exports},xC3x:function(t,i){}});