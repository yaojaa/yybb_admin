webpackJsonp([47],{KEdi:function(t,s,o){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var e=o("woOf"),a=o.n(e),r={components:{BreadCrumb:o("tVcc").a},data:function(){return{breadcrumb:[{name:"订单管理"},{name:"商品订单",url:"/order/list_goods"},{name:"发货"}],d:{},textarea:"",from_goods_list:[],to_goods_list:[],last_code:"",current_goods:{num:1,goods_name:"",goods_ico:"",goods_barcode:""},form:{dis_send_remark:"",address_id:"",dis_identity:""},dialogFormVisible:!1,sendList:[],expressList:[],formLabelWidth:"120px"}},beforeRouteUpdate:function(t,s,o){},created:function(){console.log("created")},watch:{textarea:function(t,s){var o=this;console.log("watch");var e=t.replace("\n","");""!==e&&(console.log("str",e),this.checkScanGoods(e)&&setTimeout(function(){o.textarea=""},1e3))}},computed:{},mounted:function(){this.getData(this.$route.params)},methods:{printExpres:function(){var t=this;console.log(this.to_goods_list,"to_goods_list"),this.dialogFormVisible=!0,this.$axios({method:"get",url:"/api/admin/select/address?contacts_send=1"}).then(function(s){0==s.data.code?t.sendList=s.data.data:t.$alert("接口返回错误")}).catch(function(s){t.$alert("接口返回错误"+s)}),this.$axios({method:"get",url:"/api/admin/select/expressCompany"}).then(function(s){0==s.data.code?t.expressList=s.data.data:t.$alert("接口返回错误")}).catch(function(s){t.$alert("接口返回错误"+s)})},sendGoods:function(){var t=this;console.log(this.to_goods_list,"this.to_goods_list");var s={order_code:this.d.order_code,dis_send_id:this.form.address_id,dis_send_remark:this.form.dis_send_remark,dis_identity:this.form.dis_identity,goods_list:[{goods_barcode:this.to_goods_list[0].goods_barcode,goods_num:this.to_goods_list[0].goods_num}]};this.$axios.post("/api/admin/order/createDis",s).then(function(s){0==s.data.code?(t.$alert("发货成功！"),t.$router.push("/order/list_goods")):t.$alert(s.data.msg)}).catch(function(s){t.$alert("操作失败"+s)})},checkScanGoods:function(t){for(var s=this,o=!1,e=0;e<this.to_goods_list.length;e++)if(this.to_goods_list[e].goods_barcode==t)return this.$message("此商品已扫描完毕");return this.current_goods.goods_barcode==t?(this.current_goods.num+=1,this.current_goods.num==this.current_goods.goods_num&&this.toSendArea(),o=!0):(this.from_goods_list.forEach(function(e,r){if(console.log("循环from list 查找商品"),e.goods_barcode==t){if(e.goods_num==s.current_goods.num)return console.log("数量相等了"),void s.toSendArea();s.current_goods=a()({},s.current_goods,e),s.current_goods.num=1,o=!0}}),o)},toSendArea:function(){for(var t=this,s=0;s<this.from_goods_list.length;s++){var o=this.from_goods_list[s];if(o.goods_barcode==this.current_goods.goods_barcode&&o.goods_num!==this.current_goods.num)return this.$message("商品数量不匹配"),!1}console.log("没有停止执行"),this.to_goods_list.length?this.to_goods_list.forEach(function(s){s.goods_barcode==t.current_goods.goods_barcode?t.$message("商品已存在，请重新扫描其它产品"):(t.to_goods_list.push(t.current_goods),t.current_goods={num:0,goods_name:"",goods_ico:"",goods_barcode:""})}):(this.to_goods_list.push(this.current_goods),this.current_goods={num:0,goods_name:"",goods_ico:"",goods_barcode:""})},numhandleChange:function(t){console.log(t)},getData:function(t){var s=this;this.$axios({method:"get",url:"/api/admin/order/confirmDis",params:t}).then(function(t){0==t.data.code?(s.d=t.data.data,s.from_goods_list=t.data.data.goods_list):s.$message({message:t.data.msg,type:"warning"})}).catch(function(t){console.log(t)})}}},d={render:function(){var t=this,s=t.$createElement,o=t._self._c||s;return o("div",{staticClass:"page"},[o("div",{staticClass:"page-header"},[o("bread-crumb",{attrs:{"bread-crumb":t.breadcrumb}})],1),t._v(" "),o("div",{staticClass:"page-content"},[o("div",{staticClass:"panel"},[t._m(0),t._v(" "),o("div",{staticClass:"panel-body"},[o("div",{staticClass:"info_p"},[t._v("\n                    收件人："+t._s(t.d.order_user_name)),o("br"),t._v("\n                    收货地址："+t._s(t.d.order_user_address)),o("br"),t._v("\n                    备注："+t._s(t.d.order_remark)),o("br")])])]),t._v(" "),o("div",{staticClass:"panel"},[o("el-row",{attrs:{gutter:8}},[o("el-col",{attrs:{span:8}},[o("el-card",{staticClass:"box-card"},[o("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[o("span",[t._v("待发货")])]),t._v(" "),t._l(t.from_goods_list,function(s){return o("div",{key:s.id,staticClass:"text clearfix flex_box"},[o("div",{staticClass:"img"},[o("img",{attrs:{src:s.goods_img,width:"50",height:"50"}})]),t._v(" "),o("div",{staticClass:"con"},[o("p",[t._v("名称："+t._s(s.goods_name))]),t._v(" "),o("p",[t._v("编码："+t._s(s.goods_barcode))]),t._v(" "),o("p",[t._v("数量："+t._s(s.goods_num))])])])})],2)],1),t._v(" "),o("el-col",{attrs:{span:10}},[o("el-card",{staticClass:"box-card"},[o("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[o("span",[t._v("操作区")])]),t._v(" "),o("el-card",{attrs:{shadow:"always"}},[o("el-input",{attrs:{type:"input",rows:2,placeholder:"请扫描商品"},model:{value:t.textarea,callback:function(s){t.textarea="string"==typeof s?s.trim():s},expression:"textarea"}})],1),t._v(" "),o("br"),o("br"),t._v(" "),t.current_goods.goods_name?o("el-card",{attrs:{shadow:"always"}},[o("h1",{staticStyle:{color:"red","font-size":"18px"}},[t._v('\n                该商品"'+t._s(t.current_goods.goods_name)+'"共'+t._s(t.current_goods.goods_num)+"件，\n\n\n                "),t.current_goods.goods_num-t.current_goods.num==0?o("div",[t._v(" 已扫全")]):o("div",[t._v(" 还差"+t._s(t.current_goods.goods_num-t.current_goods.num)+"件代扫")])])]):t._e(),t._v(" "),t.current_goods.goods_name?o("el-card",{attrs:{shadow:"always"}},[o("div",{staticClass:"flex_box"},[o("div",{staticClass:"current-img"},[o("img",{attrs:{src:t.current_goods.goods_img,width:"50",height:"50"}})]),t._v(" "),o("div",{staticClass:"goods_conent"},[o("p",{staticClass:"current-p"},[t._v("商品名："+t._s(t.current_goods.goods_name))]),t._v(" "),o("el-input-number",{attrs:{min:1,label:"数量"},on:{change:t.numhandleChange},model:{value:t.current_goods.num,callback:function(s){t.$set(t.current_goods,"num",s)},expression:"current_goods.num"}}),t._v(" "),o("br"),t._v(" "),o("br"),t._v(" "),o("el-button",{attrs:{size:"large",type:"success"},on:{click:t.toSendArea}},[t._v("确定")])],1)])]):t._e()],1)],1),t._v(" "),o("el-col",{attrs:{span:6}},[o("el-card",{staticClass:"box-card"},[o("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[o("span",[t._v("待确认发货")])]),t._v(" "),t.to_goods_list?o("div",{staticClass:"to-p"},[o("p",[t._v("请扫描商品")])]):o("div",t._l(t.to_goods_list,function(s){return o("div",{key:s.id,staticClass:"text clearfix flex_box"},[o("div",{staticClass:"img"},[o("img",{attrs:{src:s.goods_img,width:"50",height:"50"}})]),t._v(" "),o("div",{staticClass:"con"},[o("p",[t._v("商品名："+t._s(s.goods_name))]),t._v(" "),o("p",[t._v("商品数量："+t._s(s.num))])])])})),t._v(" "),o("el-button",{attrs:{size:"large",type:"success"},on:{click:t.printExpres}},[t._v("打印快递单")]),t._v(" "),o("el-dialog",{attrs:{title:"收货地址",visible:t.dialogFormVisible},on:{"update:visible":function(s){t.dialogFormVisible=s}}},[o("el-form",{attrs:{model:t.form}},[o("el-form-item",{attrs:{label:"收件人姓名:","label-width":t.formLabelWidth}},[o("el-input",{attrs:{autocomplete:"off",disabled:!0},model:{value:t.d.order_user_name,callback:function(s){t.$set(t.d,"order_user_name",s)},expression:"d.order_user_name"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"收件人电话:","label-width":t.formLabelWidth}},[o("el-input",{attrs:{autocomplete:"off",disabled:!0},model:{value:t.d.order_user_phone,callback:function(s){t.$set(t.d,"order_user_phone",s)},expression:"d.order_user_phone"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"收件人地址:","label-width":t.formLabelWidth}},[o("el-input",{attrs:{autocomplete:"off",disabled:!0},model:{value:t.d.order_user_address,callback:function(s){t.$set(t.d,"order_user_address",s)},expression:"d.order_user_address"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"发件仓库","label-width":t.formLabelWidth}},[o("el-select",{attrs:{placeholder:"请选择"},model:{value:t.form.address_id,callback:function(s){t.$set(t.form,"address_id",s)},expression:"form.address_id"}},t._l(t.sendList,function(t){return o("el-option",{key:t.address_id,attrs:{label:t.contacts_name,value:t.address_id}})}))],1),t._v(" "),o("el-form-item",{attrs:{label:"寄件人备注:","label-width":t.formLabelWidth}},[o("el-input",{attrs:{type:"textarea"},model:{value:t.form.dis_send_remark,callback:function(s){t.$set(t.form,"dis_send_remark",s)},expression:"form.dis_send_remark"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"物流列表","label-width":t.formLabelWidth}},[o("el-select",{attrs:{placeholder:"请选择"},model:{value:t.form.dis_identity,callback:function(s){t.$set(t.form,"dis_identity",s)},expression:"form.dis_identity"}},t._l(t.expressList,function(t){return o("el-option",{key:t.code,attrs:{label:t.name,value:t.code}})}))],1)],1),t._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(s){t.dialogFormVisible=!1}}},[t._v("取 消")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.sendGoods}},[t._v("确 定")])],1)],1)],1)],1)],1)],1)])])},staticRenderFns:[function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"panel-heading"},[s("h3",{staticClass:"panel-title"},[this._v("订单信息")])])}]};var i=o("VU/8")(r,d,!1,function(t){o("tVZP")},"data-v-d7e68aa0",null);s.default=i.exports},tVZP:function(t,s){}});